# Generated by confd

global
        daemon
        log /dev/log daemon
        pidfile /var/run/haproxy.pid
        uid haproxy
        gid haproxy
        maxconn 4096
        tune.bufsize 384000
        stats socket /var/run/haproxy.stat mode 600

listen stats :8080
        mode http
        timeout client 90s
        timeout connect 10s
        timeout server 90s
        stats enable
        stats uri /

defaults
        log global
        option dontlognull
        option redispatch
        retries 3
        timeout client 90s
        timeout connect 10s
        timeout server 90s
        maxconn 4096
        mode http

listen keystone_admin
    bind *:35357
    {{ range gets "/services/router/backend/keystone/admin/*" }}
        {{ $endpoint := split (.Value) ":" }}
        server {{ index $endpoint 0 }} {{ .Value }} check port {{ index $endpoint 1 }} inter 12000 rise 1 fall 1
    {{ end }}

listen keystone_service
    bind *:5000
    {{ range gets "/services/router/backend/keystone/public/*" }}
        {{ $endpoint := split (.Value) ":" }}
        server {{ index $endpoint 0 }} {{ .Value }} check port {{ index $endpoint 1 }} inter 12000 rise 1 fall 1
    {{ end }}

listen neutron_server
    bind *:9696
    {{ range gets "/services/router/backend/neutron/server/*" }}
        {{ $endpoint := split (.Value) ":" }}
        server {{ index $endpoint 0 }} {{ .Value }} check port {{ index $endpoint 1 }} inter 12000 rise 1 fall 1
    {{ end }}

listen nova_api
    bind *:8774
    {{ range gets "/services/router/backend/nova/api/*" }}
        {{ $endpoint := split (.Value) ":" }}
        server {{ index $endpoint 0 }} {{ .Value }} check port {{ index $endpoint 1 }} inter 12000 rise 1 fall 1
    {{ end }}

listen nova_api_metadata
    bind *:8775
    {{ range gets "/services/router/backend/nova/api-metadata/*" }}
        {{ $endpoint := split (.Value) ":" }}
        server {{ index $endpoint 0 }} {{ .Value }} check port {{ index $endpoint 1 }} inter 12000 rise 1 fall 1
    {{ end }}

listen nova_spiceproxy
    bind *:6082
    {{ range gets "/services/router/backend/nova/spiceproxy/*" }}
        {{ $endpoint := split (.Value) ":" }}
        server {{ index $endpoint 0 }} {{ .Value }} check port {{ index $endpoint 1 }} inter 12000 rise 1 fall 1
    {{ end }}

listen horizon_api_http
    bind *:80
    {{ range gets "/services/router/backend/horizon/http/*" }}
        {{ $endpoint := split (.Value) ":" }}
        server {{ index $endpoint 0 }} {{ .Value }} check port {{ index $endpoint 1 }} inter 12000 rise 1 fall 1
    {{ end }}

listen horizon_api_https
    bind *:443
    {{ range gets "/services/router/backend/horizon/https/*" }}
        {{ $endpoint := split (.Value) ":" }}
        server {{ index $endpoint 0 }} {{ .Value }} check port {{ index $endpoint 1 }} inter 12000 rise 1 fall 1
    {{ end }}

listen heat_api
    bind *:8004
    {{ range gets "/services/router/backend/heat/api/*" }}
        {{ $endpoint := split (.Value) ":" }}
        server {{ index $endpoint 0 }} {{ .Value }} check port {{ index $endpoint 1 }} inter 12000 rise 1 fall 1
    {{ end }}

listen heat_api_cfn
    bind *:8000
    {{ range gets "/services/router/backend/heat/api-cfn/*" }}
        {{ $endpoint := split (.Value) ":" }}
        server {{ index $endpoint 0 }} {{ .Value }} check port {{ index $endpoint 1 }} inter 12000 rise 1 fall 1
    {{ end }}

listen cinder_api
    bind *:8776
    {{ range gets "/services/router/backend/cinder/api/*" }}
        {{ $endpoint := split (.Value) ":" }}
        server {{ index $endpoint 0 }} {{ .Value }} check port {{ index $endpoint 1 }} inter 12000 rise 1 fall 1
    {{ end }}

listen glance_api
    bind *:9292
    {{ range gets "/services/router/backend/glance/api/*" }}
        {{ $endpoint := split (.Value) ":" }}
        server {{ index $endpoint 0 }} {{ .Value }} check port {{ index $endpoint 1 }} inter 12000 rise 1 fall 1
    {{ end }}

listen glance_registry
    bind *:9191
    {{ range gets "/services/router/backend/glance/registry/*" }}
        {{ $endpoint := split (.Value) ":" }}
        server {{ index $endpoint 0 }} {{ .Value }} check port {{ index $endpoint 1 }} inter 12000 rise 1 fall 1
    {{ end }}

listen designate_api
    bind *:9001
    {{ range gets "/services/router/backend/designate/api/*" }}
        {{ $endpoint := split (.Value) ":" }}
        server {{ index $endpoint 0 }} {{ .Value }} check port {{ index $endpoint 1 }} inter 12000 rise 1 fall 1
    {{ end }}
