#!/usr/bin/env bash
# Generated by confd

source /openrc.sh
source $DGIS_OPENSTACK_SCRIPTS_PATH/common.sh

wait_for_endpoint $OS_SERVICE_ENDPOINT 1 10

keystone user-create \
    --name {{ getv "/services/glance/config/keystone-user" }} \
    --tenant {{ getv "/services/glance/config/keystone-tenant" }} \
    --pass {{ getv "/services/glance/config/service-password" }}

keystone user-role-add \
    --user {{ getv "/services/glance/config/keystone-user" }} \
    --role admin \
    --tenant {{ getv "/services/glance/config/keystone-tenant" }}

python $DGIS_OPENSTACK_SCRIPTS_PATH/create_service.py \
    --name glance \
    --description "Glance Image Service" \
    --type image

python $DGIS_OPENSTACK_SCRIPTS_PATH/create_endpoint.py \
    --service-name glance \
    --public-url http://{{ getv "/services/balancer/host" }}:9292 \
    --internal-url http://{{ getv "/services/balancer/host" }}:9292 \
    --admin-url http://{{ getv "/services/balancer/host" }}:9292
