#!/usr/bin/env bash
# Generated by confd

source $DGIS_OPENSTACK_SCRIPTS_PATH/common.sh
source /openrc.sh

wait_for_endpoint $OS_SERVICE_ENDPOINT 1 10

keystone tenant-create \
    --name admin \
    --enabled true \
    --description 'Admin tenant'

keystone tenant-create \
    --name service \
    --enabled true \
    --description 'Service tenant'

keystone user-create \
    --name admin \
    --tenant admin \
    --pass {{ getv "/services/keystone/config/admin-password" }}

keystone role-create \
    --name admin

keystone user-role-add \
    --user admin \
    --role admin \
    --tenant admin

python $DGIS_OPENSTACK_SCRIPTS_PATH/create_service.py \
    --type identity \
    --name keystone \
    --description 'Keystone Identity Service'

keystone user-create \
    --name keystone \
    --tenant service \
    --pass {{ getv "/services/keystone/config/service-password" }}

keystone user-role-add \
    --user keystone \
    --role admin \
    --tenant service

python $DGIS_OPENSTACK_SCRIPTS_PATH/create_endpoint.py \
    --service-name keystone \
    --admin-url http://{{ getv "/services/balancer/host" }}:35357/v2.0/ \
    --internal-url http://{{ getv "/services/balancer/host" }}:35357/v2.0/ \
    --public-url http://{{ getv "/services/balancer/host" }}:5000/v2.0/

apache2ctl stop
