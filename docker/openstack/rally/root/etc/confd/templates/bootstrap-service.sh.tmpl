#!/usr/bin/env bash
# Generated by confd

source $DGIS_OPENSTACK_SCRIPTS_PATH/common.sh
source /openrc.sh

wait_for_endpoint $OS_SERVICE_ENDPOINT 1 10

keystone tenant-get {{ getv "/services/tempest/config/tempest-tenant"  }} 2>/dev/null ||
    keystone tenant-create \
        --name {{ getv "/services/tempest/config/tempest-tenant"  }} \
        --enabled true \
        --description 'Demo tenant'

keystone user-get {{ getv "/services/tempest/config/tempest-user"  }} 2>/dev/null ||
    keystone user-create \
        --name {{ getv "/services/tempest/config/tempest-user"  }} \
        --tenant {{ getv "/services/tempest/config/tempest-tenant"  }} \
        --pass {{ getv "/services/tempest/config/tempest-password"  }}

keystone user-role-list --tenant {{ getv "/services/tempest/config/tempest-tenant"  }} --user {{ getv "/services/tempest/config/tempest-user"  }} 2> /dev/null ||
    keystone user-role-add \
        --user {{ getv "/services/tempest/config/tempest-user"  }} \
        --role admin \
        --tenant {{ getv "/services/tempest/config/tempest-tenant"  }}
